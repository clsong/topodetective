nodes = tibble(
name = topology$species
),
edges = topology %>%
gather(key, strength, -species, -r) %>%
rename(
node = species,
size = r
))
topology %>%
gather(key, strength, -species, -r) %>%
rename(
node = species,
size = r
)
topology
tbl_graph(
nodes = tibble(
name = topology$species
),
edges = topology %>%
gather(from, strength, -species, -r) %>%
rename(
to = species,
size = r
))
tbl_graph(
nodes = tibble(
name = topology$species
),
edges = topology %>%
gather(from, strength, -species, -r) %>%
rename(to = species)
) %>%
geom_edge_fan(aes(alcolor = strength), show.legend = FALSE) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = tibble(
name = topology$species
),
edges = topology %>%
gather(from, strength, -species, -r) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(alcolor = strength), show.legend = FALSE) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species, -r) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(alcolor = strength), show.legend = FALSE) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species, -r) %>%
rename(to = species)
)
topology %>%
select(species, r)
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(alcolor = strength), show.legend = FALSE) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength), show.legend = FALSE) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength)) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength, size = strength)) +
geom_node_point(aes(size = r)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength, size = strength)) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength)) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength)) +
geom_edge_fan(arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(3, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(3, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_arc(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(3, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(3, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(3, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
topology
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white')
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
#' EPlot the interaction network
#'
#' @return A ggraph project
#' @param topology
#' @export
plot_interaction_topology <- function(topology) {
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
}
plot_interaction_topology(topology_ground)
plot_topology(fitted)
fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1)
plot_interaction_topology(fitted_model)
fitted_model
topology <- topology %>%
select_if(starts_with("x")|"species")
#' EPlot the interaction network
#'
#' @return A ggraph project
#' @param topology
#' @export
plot_interaction_topology <- function(topology) {
topology <- topology %>%
select_if(starts_with("x")|"species")
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
}
plot_interaction_topology(fitted_model)
fitted_model <- topology
source("~/Dropbox (Personal)/Research_PostDoc/09_package_InferInteractions/R/fit_trajectory.R", echo=TRUE)
topology <- topology %>%
select_if(starts_with("x")|"species")
topology %>%
select_if(starts_with("x"))
topology
topology <- fitted_model
topology %>%
select(-r)
topology %>%
select(-r) %>%
gather(from, strength, -species)
topology
fitted_model <- fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1) %>%
# filter(R2 == max(R2)) %>%
ungroup()
topology <- fitted_model
topology %>%
select(-r) %>%
gather(from, strength, -species)
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(from %in% topology$species) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(from %in% topology$species)
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(from %in% topology$species) %>%
unnest(strength) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
fitted_model <- fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1) %>%
# filter(R2 == max(R2)) %>%
ungroup()
ts_simu <- simualte_fitted_dynamics(fitted_model)
plot_true_vs_simu(ts, ts_simu)
evaluate_fit(ts, ts_simu)
plot_interaction_topology(topology_ground)
#' EPlot the interaction network
#'
#' @return A ggraph project
#' @param topology
#' @export
plot_interaction_topology <- function(topology) {
tbl_graph(
nodes = topology %>%
select(species, r),
edges = topology %>%
select(-r) %>%
gather(from, strength, -species) %>%
filter(from %in% topology$species) %>%
unnest(strength) %>%
filter(strength != 0) %>%
filter(!is.na(strength)) %>%
rename(to = species)
) %>%
ggraph(layout = 'kk') +
geom_edge_fan(aes(color = strength),
arrow = arrow(length = unit(4, 'mm')),
end_cap = circle(6, 'mm')) +
geom_node_point(aes(size = r)) +
geom_edge_loop(aes(colour = strength)) +
scale_edge_colour_viridis() +
theme_graph(foreground = 'steelblue', fg_text_colour = 'white') +
theme(aspect.ratio = 1)
}
plot_interaction_topology(topology_ground)
plot_interaction_topology(fitted_model)
topology_fitted <- fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1) %>%
# filter(R2 == max(R2)) %>%
ungroup()
# packages ----------------------------------------------------------------
library(deSolve)
library(magrittr)
library(purrr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(jtools)
library(rsample)
library(tibble)
library(broom)
library(recipes)
library(parsnip)
library(workflows)
library(tune)
library(yardstick)
library(patchwork)
library(tidygraph)
library(ggraph)
library(InferInteractions)
theme_set(jtools::theme_nice())
library(InferInteractions)
get_classic_dynamics("chaos") # choose a dynamic
ts <- generate_time_series(eqns_per, time_range, state_initial, species_num) # simulate a dynamic
plot_time_series(ts)
reg_model <- choose_regression_model("linear")
fitted_models <- ts %>%
preprocess_ts() %>%
group_split(species) %>%
map(fit_interaction_parameters) %>%
bind_rows(.id = 'species') %>%
mutate(species = paste0("x", species))
topology_fitted <- fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1) %>%
# filter(R2 == max(R2)) %>%
ungroup()
ts_simu <- simualte_fitted_dynamics(topology_fitted)
plot_true_vs_simu(ts, ts_simu)
evaluate_fit(ts, ts_simu)
topology_fitted <- fitted_models %>%
filter(R2 > .8) %>%
group_by(species) %>%
sample_n(1) %>%
# filter(R2 == max(R2)) %>%
ungroup()
ts_simu <- simualte_fitted_dynamics(topology_fitted)
plot_true_vs_simu(ts, ts_simu)
evaluate_fit(ts, ts_simu)
plot_interaction_topology(topology_ground)
plot_interaction_topology(topology_fitted)
library(devtools)
use_readme_rmd()
library(tidyverse)
library(tidyverse)
library(InferInteractions)
